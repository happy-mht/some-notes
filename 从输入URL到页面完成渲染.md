# 从输入URL到页面加载完成的过程中发生了什么事？

## 1、从输入URL到浏览器接收的过程中发生了什么？

[输入 URL]，键盘或触摸屏与浏览器的交互，主要涉及硬件。。。。

## 2、浏览器如何向网卡发送数据？

### 1. 从浏览器到浏览器内核

输入 URL 后 [回车]，这是浏览器会对URL进行检查，首先判断协议，如果是 http 就按照 web 来处理，另外还会对这个URL进行安全检查，然后直接调用浏览器内核中的对应方法。

在浏览器内核中会先查看缓存，然后设置 UA(User-Agent：浏览器类型) 等 HTTP 信息，接着调用不同平台下网络请求的方法。
> 需要注意浏览器和浏览器内核是不同的概念，浏览器指的是 Chrome、Firefox，而浏览器内核则是 Blink、Gecko，浏览器内核只负责渲染，GUI 及网络连接等跨平台工作则是浏览器实现的

### 2. HTTP 请求的发送

因为网络的底层实现和内核相关，所以这一部分需要针对不同的平台进行处理，从应用层角度看主要做2件事：通过DNS 查询 IP、通过 socket 发送数据。

#### DNS 查询

DNS 查询基于 UDP 实现

- 主机向本地域名服务器的查询一般都是采用递归查询。
- 本地域名服务器向根域名服务器的查询的迭代查询。

#### Socket 发送数据

有IP地址后，就可以通过socket API 发送数据。

HTTP 常用的是TCP协议，

> 浏览器对同一个域名有连接数限制，大部分是 6，我以前认为将这个连接数改大后会提升性能，但实际上并不是这样的，Chrome 团队有做过实验，发现从 6 改成 10 后性能反而下降了，造成这个现象的因素有很多，如建立连接的开销、拥塞控制等问题，而像 SPDY、HTTP 2.0 协议尽管只使用一个 TCP 连接来传输数据，但性能反而更好，而且还能实现请求优先级。

## 三、数据如何从本机网卡发送到服务器？

## 四、服务器接收到数据后会进行哪些处理？

### 负载均衡

将请求合理地分配到多个服务器上，同时具备具备防攻击等功能。

### 反向代理

反向代理是工作在 HTTP 上的，具体实现可以基于 HAProxy 或 Nginx，因为反向代理能理解 HTTP 协议，所以能做非常多的事情，比如：

- 进行很多统一处理，比如防攻击策略、防抓取、SSL、gzip、自动性能优化等
- 应用层的分流策略都能在这里做，比如对 /xx 路径的请求分到 a 服务器，对 /yy 路径的请求分 到 b 服务器，或者按照 cookie 进行小流量测试等
- 缓存，并在后端服务挂掉的时候显示友好的 404 页面
- 监控后端服务是否异常
- ⋯⋯

### web server 中的处理

请求经过前面的负载均衡后，将进入到对应服务器上的 Web Server，比如 Apache、Tomcat、Node.JS 等。

### 进入后端语言

### web 框架（Framework）

一般网站都会会基于某个 Web 框架来开发，因此在后端语言执行时首先进入 Web 框架的代码，然后由框架再去调用应用的实现代码。

### 读取数据

从简单的读写文件到数据中间层

## 五、服务器返回数据后浏览器如何处理？

### 从 01 到字符

HTTP 请求返回的 HTML 传递到浏览器后，如果有 gzip 会先解压，然后接下来最重要的问题是要知道它的编码是什么，比如同样一个「中」字，在 UTF-8 编码下它的内容其实是「11100100 10111000 10101101」也就是「E4 B8 AD」，而在 GBK 下则是「11010110 11010000」，也就是「D6 D0」，如何才能知道文件的编码？可以有很多判断方法：

- 用户设置，在浏览器中可以指定页面编码
- HTTP 协议中
- `<meta>` 中的 `charset` 属性值
- 对于 JS 和 CSS
- 对于 `iframe`

### 外链资源的加载

### JavaScript 的执行

### 从字符到图片

二维渲染中最复杂的要数文字显示了，虽然想想似乎很简单，不就是将某个文字对应的字形(glyph)找出来么？在中文和英文中这样做是没问题的，因为一个字符就对应一个字形(glyph)，在字体文件中找到字形，然后画上去就可以了，但在阿拉伯语中是不行的，因为它有有连体形式。

### 跨平台 2D 绘制库

在不同操作系统中都提供了自己的图形绘制 API，比如 Mac OS X 下的 Quartz，Windows 下的 GDI 以及 Linux 下的 Xlib，但它们相互不兼容，所以为了方便支持跨平台绘图，在 Chrome 中使用了 `Skia` 库。

### GPU 合成

## 六、浏览器如何将页面展现出来？

前面提到浏览器已经将页面渲染成一张图片了，接下来的问题就是如何将这张图片展示在屏幕上。

## 参考链接

http://fex.baidu.com/blog/2014/05/what-happen/